# Eva Exchange

 **This workspace has been generated by [Nx, a Smart, fast and extensible build system.](https://nx.dev)**

## Dependecies

```
nodejs: 16
nx: 16
typescript: 5
typeorm
postgre

```


## Environment Variables
change variables from .env file

```
POSTGRES_USER='evauser' #for docker
POSTGRES_PASSWORD='eva123' #for docker
POSTGRES_DB='evaexchange' #for docker
PGDATA='/data/postgres-evauser' #for docker
SERVER_PORT=3333 #for docker and local development
DB_URL='postgres://evauser:eva123@localhost:5432/evaexchange' #for local development
```

## Start the app

First initilize

For Development
```
yarn install
```


For Development
```
yarn dev
```
For Docker run
```
yarn docker
```

## Endpoints: 
#### Base Url :
```
http://localhost:3333/api
```

| VERB | URL | Header | Params | Body | Description |
|------|-----|--|------|------|-------|
| POST |/auth/login|||{ "email": "string", "password": "string"}|  |
| POST |/auth/register|||{ "email": "string", "password": "string", "name": "string"}|  password must contains 1 nmber, 1 symbo, 1 lowecase, 1 uppercase character|
| GET |/share/id|{auth}:token string from login response| {id} share id [query paramerters](https://github.com/nestjsx/crud/wiki/Requests)| |  Get specific share data |
| GET |/share| {auth}:token string from login response| [query paramerters](https://github.com/nestjsx/crud/wiki/Requests)| |  Get list of share data |
| POST |/share| {auth}:token string from login response| |{"name": "Demo 1", "code": "D01","price": 11.5} |  Create Share definition |
| PATCH |/share| {auth}:token string from login response| |{"name": "Demo 1", "code": "D01","price": 11.5} |  Update Share definition. Allow one time in 1 hour if price changed |
| POST |/portfolio| {auth}:token string from login response| ||  Create portfolio for authanticated user if not exists |
| POST |/transactions/buy| {auth}:token string from login response| |{"count": 1,"share": {"id": 1}}|  Create buy transaction for authanticated user and specific share  |
| POST |/transactions/sell| {auth}:token string from login response| |{"count": 1,"share": {"id": 1}}|  Create sell transaction for authanticated user and specific share if portfolio share has or ennough  |

## Postman Notes

1. import collection file to Postman 
```
evaexchange.postman_collection.json
```
1. send Auth/register request
2. send Auth/login request. when successfully, automatically set auth header environment variable for all other requests
3. send Share/create request. use responsed share id for transactions
4. send Portfolio/create request. creates a portfolio information for authanticated user if not exists
5. send Transaction/buy request. creates a buy transaction for for authanticated user and share
5. send Transaction/sell request. creates a sell transaction for for authanticated user and share if thi share exists or enough in authanticated user's portfolio
